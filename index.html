<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LEGO City Learning ‚Äì Petr‚Äôs Missions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #fee2e2 0, #fef3c7 30%, #eff6ff 80%);
      color: #111827;
    }

    header {
      padding: 1.1rem 1.5rem;
      background: linear-gradient(90deg, #0ea5e9, #6366f1);
      color: white;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    header h1 span {
      font-size: 2rem;
    }

    header small {
      display: block;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .top-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    label {
      font-size: 0.8rem;
      color: #e5e7eb;
    }

    input[type="text"],
    select {
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      padding: 0.35rem 0.6rem;
      font-size: 0.9rem;
      background: white;
      min-width: 0;
    }

    main {
      max-width: 1180px;
      margin: 0 auto 2rem;
      padding: 1rem;
    }

    .hero {
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.2fr);
      gap: 1rem;
    }

    @media (max-width: 900px) {
      .hero {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: white;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.1);
      position: relative;
      overflow: hidden;
    }

    .hero-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .hero-title span {
      font-size: 1.4rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.75rem;
      padding: 0.1rem 0.6rem;
      border-radius: 999px;
      background: #fef3c7;
      border: 1px solid #facc15;
      color: #92400e;
      margin-bottom: 0.4rem;
    }

    .hero-text {
      font-size: 0.9rem;
      color: #374151;
    }

    .lego-city {
      display: grid;
      gap: 0.35rem;
      margin-top: 0.5rem;
    }

    .lego-row {
      display: flex;
      gap: 0.3rem;
    }

    .brick {
      flex: 1;
      height: 26px;
      border-radius: 0.4rem;
      position: relative;
      box-shadow: 0 3px 0 rgba(15, 23, 42, 0.25);
      animation: floatBrick 4s ease-in-out infinite;
    }

    .lego-row:nth-child(2) .brick {
      animation-delay: 0.5s;
    }

    .brick::before {
      content: "";
      position: absolute;
      top: -7px;
      left: 6px;
      width: 14px;
      height: 7px;
      border-radius: 0.4rem 0.4rem 0.1rem 0.1rem;
      background: rgba(255, 255, 255, 0.4);
    }

    .brick.red { background: #f97373; }
    .brick.blue { background: #3b82f6; }
    .brick.yellow { background: #facc15; }
    .brick.green { background: #22c55e; }

    @keyframes floatBrick {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

    .robot-bubble {
      background: #111827;
      color: white;
      border-radius: 1.3rem;
      padding: 0.7rem 0.9rem;
      font-size: 0.85rem;
      margin-bottom: 0.4rem;
      max-width: 270px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.35);
    }

    .robot-face {
      font-size: 3.4rem;
      text-align: center;
      animation: robotWave 2.8s ease-in-out infinite;
    }

    @keyframes robotWave {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-3px) rotate(-3deg); }
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.6fr);
      gap: 1rem;
      margin-top: 0.5rem;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    h2.section-title {
      font-size: 1rem;
      margin: 0 0 0.3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .badge {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      white-space: nowrap;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      align-items: center;
      font-size: 0.8rem;
      color: #4b5563;
    }

    .missions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 0.7rem;
    }

    .mission-card {
      border-radius: 1rem;
      border: 1px solid #e5e7eb;
      padding: 0.7rem 0.7rem 0.6rem;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      position: relative;
      overflow: hidden;
    }

    .mission-card::after {
      content: "";
      position: absolute;
      inset: auto -30px -30px auto;
      width: 60px;
      height: 60px;
      border-radius: 999px;
      background: radial-gradient(circle at center, rgba(59,130,246,0.25), transparent);
    }

    .mission-domain {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6b7280;
    }

    .mission-title {
      font-size: 0.92rem;
      font-weight: 700;
      color: #111827;
    }

    .mission-desc {
      font-size: 0.78rem;
      color: #4b5563;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 0.35rem 0.7rem;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      text-decoration: none;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .btn-ghost {
      background: transparent;
      border: 1px dashed #9ca3af;
      color: #374151;
    }

    .mission-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.15rem;
    }

    .mission-status {
      margin-top: 0.3rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      font-size: 0.78rem;
      color: #374151;
    }

    .mission-status label {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
    }

    .mission-status input[type="checkbox"] {
      transform: scale(1.05);
      cursor: pointer;
    }

    details {
      margin-top: 0.25rem;
      font-size: 0.78rem;
    }

    details summary {
      cursor: pointer;
      color: #2563eb;
      list-style: none;
    }

    details summary::marker,
    details summary::-webkit-details-marker {
      display: none;
    }

    details summary::before {
      content: "‚ñ∂";
      font-size: 0.7rem;
      margin-right: 0.3rem;
      display: inline-block;
      transform: translateY(-1px);
    }

    details[open] summary::before {
      content: "‚ñº";
    }

    .progress-card {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .progress-bar-wrapper {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      transition: width 0.2s ease-out;
    }

    .small-text {
      font-size: 0.78rem;
      color: #6b7280;
    }

    textarea {
      width: 100%;
      resize: vertical;
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.6rem;
      font-size: 0.85rem;
      min-height: 120px;
    }

    .phrases-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 0.6rem;
      margin-top: 0.4rem;
    }

    .phrase-card {
      border-radius: 0.9rem;
      padding: 0.5rem 0.6rem;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .phrase-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .phrase-text-main {
      font-weight: 600;
    }

    .phrase-translation {
      font-size: 0.75rem;
      color: #4b5563;
    }

    .footer-note {
      text-align: center;
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
<header>
  <div>
    <h1><span>üß±</span> LEGO City Learning</h1>
    <small>Four weeks of city missions for Petr ‚Äì English, Slovene, maths & more</small>
  </div>
  <div class="top-controls">
    <label>
      Child name:
      <input type="text" id="childName" placeholder="Petr" />
    </label>
    <label>
      Week:
      <select id="weekSelect">
        <option value="week1">Week 1 ‚Äì City Heroes</option>
        <option value="week2">Week 2 ‚Äì City Vehicles</option>
        <option value="week3">Week 3 ‚Äì City Jobs</option>
        <option value="week4">Week 4 ‚Äì City Adventures</option>
      </select>
    </label>
    <label>
      Day:
      <select id="daySelect">
        <option value="sat">Saturday</option>
        <option value="sun">Sunday</option>
        <option value="mon">Monday</option>
        <option value="tue">Tuesday</option>
        <option value="wed">Wednesday</option>
      </select>
    </label>
  </div>
</header>

<main>
  <!-- Hero -->
  <section class="hero">
    <div class="card">
      <div class="hero-title"><span>üèôÔ∏è</span>Welcome to LEGO City skills lab</div>
      <div class="pill">7 skills every day ¬∑ Saturday to Wednesday ¬∑ 4 weeks</div>
      <p class="hero-text">
        Each day Petr completes 7 short LEGO City missions: English, Slovene, social confidence,
        fine motor skills, maths, creativity and ‚ÄúUnderstanding the World‚Äù. Download the PDF,
        follow the parent dialogue and use the audio phrases to practise speaking.
      </p>
      <div class="lego-city" aria-hidden="true">
        <div class="lego-row">
          <div class="brick red"></div>
          <div class="brick blue"></div>
          <div class="brick yellow"></div>
          <div class="brick green"></div>
        </div>
        <div class="lego-row">
          <div class="brick blue"></div>
          <div class="brick yellow"></div>
          <div class="brick red"></div>
          <div class="brick green"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="robot-bubble">
        Hi! I am your LEGO City robot. Choose a week and a day, download the PDFs
        and follow the dialogues. Let‚Äôs help Petr speak, move, count and play with confidence.
      </div>
      <div class="robot-face">ü§ñ</div>
    </div>
  </section>

  <!-- Phrases -->
  <section class="card">
    <h2 class="section-title">
      New phrases this week
      <span class="badge" id="phrasesWeekLabel">Week 1 ‚Äì City Heroes</span>
    </h2>
    <p class="small-text">
      Use these phrases during play and while doing the PDFs. Click the ‚ñ∂ button to play audio
      once you upload mp3 files to the <code>audio/</code> folder.
    </p>

    <div class="phrases-grid" id="englishPhrases"></div>
    <div class="phrases-grid" id="slovenePhrases"></div>
  </section>

  <!-- Layout -->
  <section class="layout">
    <!-- Daily missions -->
    <section class="card">
      <h2 class="section-title">
        Daily missions for selected day
        <span class="badge" id="dayLabel"></span>
      </h2>
      <div class="controls-row">
        <span>7 missions: one for each skill area.</span>
      </div>
      <div class="missions-grid" id="missionsGrid"></div>
    </section>

    <!-- Progress + notes -->
    <aside class="card progress-card">
      <h2 class="section-title">
        Progress today
        <span class="badge" id="childLabel">Petr</span>
      </h2>

      <div>
        <div>Total missions today: <strong id="totalMissions">0</strong></div>
        <div>Done by child: <strong id="doneCount">0</strong></div>
        <div>Checked by parent: <strong id="checkedCount">0</strong></div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <p class="small-text">
          The bar shows how many missions are <strong>checked by parent</strong>.
        </p>
      </div>

      <div>
        <label for="notesArea">Parent notes for this day</label>
        <textarea id="notesArea" placeholder="Observations, new words, social confidence, fine motor skills‚Ä¶"></textarea>
      </div>
    </aside>
  </section>

  <p class="footer-note">
    All data is stored locally in this browser (localStorage). Upload your own PDFs and audio files
    to make the experience fully personal for Petr.
  </p>
</main>

<script>
  (function () {
    const STORAGE_KEY = "legoCityProgram_v1";

    const childNameInput = document.getElementById("childName");
    const weekSelect = document.getElementById("weekSelect");
    const daySelect = document.getElementById("daySelect");
    const missionsGrid = document.getElementById("missionsGrid");
    const dayLabel = document.getElementById("dayLabel");
    const childLabel = document.getElementById("childLabel");
    const totalMissionsEl = document.getElementById("totalMissions");
    const doneCountEl = document.getElementById("doneCount");
    const checkedCountEl = document.getElementById("checkedCount");
    const progressBarEl = document.getElementById("progressBar");
    const notesArea = document.getElementById("notesArea");
    const phrasesWeekLabel = document.getElementById("phrasesWeekLabel");
    const englishPhrasesEl = document.getElementById("englishPhrases");
    const slovenePhrasesEl = document.getElementById("slovenePhrases");

    const DAYS_LABEL = {
      sat: "Saturday",
      sun: "Sunday",
      mon: "Monday",
      tue: "Tuesday",
      wed: "Wednesday"
    };

    // === Program data ===
    // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏: –ø–æ–ª–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ PDF –ø–æ–¥—Ä–æ–±–Ω–æ –¥–ª—è Week1, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ–¥–µ–ª–∏ ‚Äì —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç, –Ω–æ –∫–æ—Ä–æ—á–µ.
    const PROGRAM = {
      week1: {
        label: "Week 1 ‚Äì City Heroes",
        englishPhrases: [
          {
            id: "w1_en_1",
            text: "What did you build today?",
            translation: "–ß—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è –ø–æ—Å—Ç—Ä–æ–∏–ª?",
            tip: "–ü–æ–º–æ–≥–∞–µ—Ç –ü–µ—Ç—Ä—É —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ —Å–≤–æ—ë–º –¥–Ω–µ –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏."
          },
          {
            id: "w1_en_2",
            text: "Can you tell me the story?",
            translation: "–†–∞—Å—Å–∫–∞–∂–µ—à—å –º–Ω–µ —ç—Ç—É –∏—Å—Ç–æ—Ä–∏—é?",
            tip: "–¢—Ä–µ–Ω–∏—Ä—É–µ–º –ø–µ—Ä–µ—Å–∫–∞–∑."
          },
          {
            id: "w1_en_3",
            text: "I can see a big red fire truck.",
            translation: "–Ø –≤–∏–∂—É –±–æ–ª—å—à–æ–π –∫—Ä–∞—Å–Ω—ã–π –ø–æ–∂–∞—Ä–Ω—ã–π –≥—Ä—É–∑–æ–≤–∏–∫.",
            tip: "–ú–æ–¥–µ–ª—å –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è."
          },
          {
            id: "w1_en_4",
            text: "How does your hero feel?",
            translation: "–ö–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç —Ç–≤–æ–π –≥–µ—Ä–æ–π?",
            tip: "–£—á–∏–º—Å—è –Ω–∞–∑—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏."
          }
        ],
        slovenePhrases: [
          {
            id: "w1_sl_1",
            text: "Kaj je to?",
            translation: "–ß—Ç–æ —ç—Ç–æ?",
            tip: "–ë–∞–∑–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∫ –ø—Ä–µ–¥–º–µ—Ç–∞–º."
          },
          {
            id: "w1_sl_2",
            text: "To je gasilski avto.",
            translation: "–≠—Ç–æ –ø–æ–∂–∞—Ä–Ω–∞—è –º–∞—à–∏–Ω–∞.",
            tip: "–ü—Ä–æ—Å—Ç—ã–µ –∏–º–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è."
          },
          {
            id: "w1_sl_3",
            text: "Kako se poƒçuti≈°?",
            translation: "–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?",
            tip: "–≠–º–æ—Ü–∏–∏ –Ω–∞ —Å–ª–æ–≤–µ–Ω—Å–∫–æ–º."
          },
          {
            id: "w1_sl_4",
            text: "Rad imam LEGO mesto.",
            translation: "–Ø –ª—é–±–ª—é –≥–æ—Ä–æ–¥ LEGO.",
            tip: "–Ø-–≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è."
          }
        ],
        days: {
          sat: {
            title: "Start Mission ‚Äì Fire Station Day",
            activities: [
              {
                id: "eng",
                domain: "English Speaking & Listening",
                title: "Fire station story time",
                pdf: "pdf/w1-sat-english-fire-station-story.pdf",
                desc: "–ö–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ–∂–∞—Ä–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏. –ü—ë—Ç—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ –ø–æ–∂–∞—Ä–Ω—ã—Ö.",
                dialog: [
                  "Parent: Look at the picture. What can you see?",
                  "Child: I can see a fire truck.",
                  "Parent: What is the firefighter doing?",
                  "Child: He is helping people.",
                  "Parent: Can you tell me the story of this fire truck?"
                ]
              },
              {
                id: "social",
                domain: "Social Confidence / Group Interaction",
                title: "Firefighters‚Äô team talk",
                pdf: "pdf/w1-sat-social-fire-team-cards.pdf",
                desc: "–ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ä–æ–ª—è–º–∏: –∫–æ–º–∞–Ω–¥–∏—Ä, –≤–æ–¥–∏—Ç–µ–ª—å, –ø–æ–º–æ—â–Ω–∏–∫. –†–æ–¥–∏—Ç–µ–ª—å –∏ —Ä–µ–±—ë–Ω–æ–∫ —Ä–∞–∑—ã–≥—Ä—ã–≤–∞—é—Ç –¥–∏–∞–ª–æ–≥.",
                dialog: [
                  "Parent: You are the firefighter, I am the captain.",
                  "Parent: ‚ÄúPetr, can you help me? We need water!‚Äù",
                  "Child: ‚ÄúYes, I can help. I will drive the truck!‚Äù",
                  "Parent: ‚ÄúThank you! You are part of the team.‚Äù"
                ]
              },
              {
                id: "motor",
                domain: "Fine Motor Skills / Early Writing",
                title: "Follow the hoses",
                pdf: "pdf/w1-sat-motor-fire-hose-lines.pdf",
                desc: "–ü—Ä—è–º—ã–µ, –≤–æ–ª–Ω–∏—Å—Ç—ã–µ –∏ –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ ‚Äì —à–ª–∞–Ω–≥–∏ –æ—Ç –º–∞—à–∏–Ω—ã –∫ –æ–≥–Ω—é. –û–±–≤–æ–¥–∏–º –∫–∞—Ä–∞–Ω–¥–∞—à–æ–º.",
                dialog: [
                  "Parent: Let‚Äôs help the water reach the fire.",
                  "Parent: Follow the line slowly with your pencil.",
                  "Parent: Great control! The water reached the fire."
                ]
              },
              {
                id: "maths",
                domain: "Maths (Numbers & Shapes)",
                title: "Count the fire trucks",
                pdf: "pdf/w1-sat-maths-fire-trucks-count.pdf",
                desc: "–°—á–∏—Ç–∞–µ–º –ø–æ–∂–∞—Ä–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ –∫–æ–ª—ë—Å–∞, –ø–∏—à–µ–º —Ü–∏—Ñ—Ä—ã 1‚Äì10.",
                dialog: [
                  "Parent: How many fire trucks can you see?",
                  "Child: Three.",
                  "Parent: Can you circle number 3?",
                  "Parent: Let‚Äôs count the wheels together."
                ]
              },
              {
                id: "slovene",
                domain: "Slovene Language",
                title: "Kaj je v gasilski postaji?",
                pdf: "pdf/w1-sat-slovene-fire-station-objects.pdf",
                desc: "–ü–æ–¥–ø–∏—Å–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º –Ω–∞ —Å–ª–æ–≤–µ–Ω—Å–∫–æ–º: gasilski avto, ƒçelada, voda.",
                dialog: [
                  "Parent: Kaj je to?",
                  "Child: To je gasilski avto.",
                  "Parent: Super! In kaj je to?",
                  "Child: To je ƒçelada."
                ]
              },
              {
                id: "creative",
                domain: "Creative Development (Art & Role Play)",
                title: "Build a small fire station",
                pdf: "pdf/w1-sat-creative-fire-station-idea-card.pdf",
                desc: "–ò–¥–µ—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ LEGO –∏ –ª–∏—Å—Ç –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞ —Å–≤–æ–µ–π —Å—Ç–∞–Ω—Ü–∏–∏.",
                dialog: [
                  "Parent: Let‚Äôs build your own fire station.",
                  "Parent: Where is the garage? Where do people wait?",
                  "Child: Here is the garage, here is the door."
                ]
              },
              {
                id: "world",
                domain: "Understanding the World",
                title: "Why do we need firefighters?",
                pdf: "pdf/w1-sat-world-fire-safety-pictures.pdf",
                desc: "–ö–∞—Ä—Ç–∏–Ω–∫–∏: –æ–≥–æ–Ω—å, –¥–æ–º, –ø–æ–∂–∞—Ä–Ω—ã–µ. –û–±—Å—É–∂–¥–∞–µ–º, –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã.",
                dialog: [
                  "Parent: Why do we need firefighters?",
                  "Child: Because of fire.",
                  "Parent: They help people and keep the city safe."
                ]
              }
            ]
          },
          sun: {
            title: "Police Day ‚Äì LEGO City Police Station",
            activities: [
              {
                id: "eng",
                domain: "English Speaking & Listening",
                title: "Police car story",
                pdf: "pdf/w1-sun-english-police-story.pdf",
                desc: "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Å –ø–æ–≥–æ–Ω–µ–π. –ü—ë—Ç—Ä –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.",
                dialog: [
                  "Parent: What can you see in picture one?",
                  "Child: I see a police car.",
                  "Parent: What happens next?",
                  "Child: The car is driving fast."
                ]
              },
              {
                id: "social",
                domain: "Social Confidence / Group Interaction",
                title: "Police & citizen role play",
                pdf: "pdf/w1-sun-social-police-dialogue-cards.pdf",
                desc: "–ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–æ–ª–µ–π: –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–π, –ø–æ—Ç–µ—Ä—è–≤—à–∏–π—Å—è —Ä–µ–±—ë–Ω–æ–∫.",
                dialog: [
                  "Parent (police): ‚ÄúHello! How can I help you?‚Äù",
                  "Child (citizen): ‚ÄúI can‚Äôt find my mum.‚Äù",
                  "Parent: ‚ÄúDon‚Äôt worry, I will help you. What‚Äôs your name?‚Äù",
                  "Child: ‚ÄúMy name is Petr.‚Äù"
                ]
              },
              {
                id: "motor",
                domain: "Fine Motor Skills / Early Writing",
                title: "Follow the city roads",
                pdf: "pdf/w1-sun-motor-city-road-lines.pdf",
                desc: "–û–±–≤–æ–¥–∏–º –¥–æ—Ä–æ–≥–∏, –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ –ª–∏–Ω–∏–∏; –¥–æ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —É—á–∞—Å—Ç–∫–∏.",
                dialog: [
                  "Parent: Can you drive the pencil car along the road?",
                  "Parent: Try to stay inside the line."
                ]
              },
              {
                id: "maths",
                domain: "Maths (Numbers & Shapes)",
                title: "Shape badges",
                pdf: "pdf/w1-sun-maths-police-shapes.pdf",
                desc: "–ó–≤–µ–∑–¥–∞, –∫—Ä—É–≥, –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ ‚Äì –∑–Ω–∞—á–∫–∏ –∏ –∑–Ω–∞–∫–∏. –ù–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã.",
                dialog: [
                  "Parent: What shape is the badge?",
                  "Child: A star.",
                  "Parent: Can you find another star?"
                ]
              },
              {
                id: "slovene",
                domain: "Slovene Language",
                title: "Na policijski postaji",
                pdf: "pdf/w1-sun-slovene-police-station.pdf",
                desc: "–ü–æ–¥–ø–∏—Å–∏ –∏ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã: policist, avto, postaja.",
                dialog: [
                  "Parent: Kaj je to?",
                  "Child: To je policist.",
                  "Parent: Kje je policijski avto?",
                  "Child: Tukaj."
                ]
              },
              {
                id: "creative",
                domain: "Creative Development (Art & Role Play)",
                title: "Design a police badge",
                pdf: "pdf/w1-sun-creative-badge-template.pdf",
                desc: "–ö–æ–Ω—Ç—É—Ä –∑–Ω–∞—á–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–Ω–∏—è, —Ä–µ–±—ë–Ω–æ–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∏–º–≤–æ–ª—ã.",
                dialog: [
                  "Parent: Let‚Äôs design your own badge.",
                  "Parent: What colours will you use?",
                  "Child: Blue and yellow."
                ]
              },
              {
                id: "world",
                domain: "Understanding the World",
                title: "Safe and unsafe situations",
                pdf: "pdf/w1-sun-world-safe-unsafe-pictures.pdf",
                desc: "–ö–∞—Ä—Ç–∏–Ω–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ/–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –≥–æ—Ä–æ–¥–µ, –æ–±–≤–æ–¥–∏–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ.",
                dialog: [
                  "Parent: Is this safe or not safe?",
                  "Child: Not safe.",
                  "Parent: What should we do instead?"
                ]
              }
            ]
          },
          mon: {
            title: "Hospital Day ‚Äì LEGO City Ambulance",
            activities: [
              { id:"eng", domain:"English Speaking & Listening", title:"At the hospital", pdf:"pdf/w1-mon-english-hospital-story.pdf",
                desc:"–ö–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–∏—ë–º–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è, —Ä–µ–±—ë–Ω–æ–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫—Ç–æ —á—Ç–æ –¥–µ–ª–∞–µ—Ç.",
                dialog:[
                  "Parent: Who can you see here?",
                  "Child: A doctor and a patient.",
                  "Parent: What is the doctor doing?"
                ]},
              { id:"social", domain:"Social Confidence / Group Interaction", title:"Doctor & patient role play",
                pdf:"pdf/w1-mon-social-doctor-dialogue.pdf",
                desc:"–î–∏–∞–ª–æ–≥ –ø–æ –∫–∞—Ä—Ç–∞–º-—Ä–æ–ª—è–º, –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–µ–∂–ª–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã.",
                dialog:[
                  "Parent (doctor): ‚ÄúHello, how are you today?‚Äù",
                  "Child (patient): ‚ÄúI feel a little sick.‚Äù",
                  "Parent: ‚ÄúI will help you. Can you show me where it hurts?‚Äù"
                ]},
              { id:"motor", domain:"Fine Motor Skills / Early Writing", title:"Trace the medical paths",
                pdf:"pdf/w1-mon-motor-hospital-lines.pdf",
                desc:"–°–æ–µ–¥–∏–Ω—è–µ–º –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏ —Å–∫–æ—Ä—É—é –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏, —Ç—Ä–µ–Ω–∏—Ä—É–µ–º –∑–∞—Ö–≤–∞—Ç.",
                dialog:[
                  "Parent: Hold your pencil like this.",
                  "Parent: Let‚Äôs help the ambulance reach the hospital."
                ]},
              { id:"maths", domain:"Maths (Numbers & Shapes)", title:"Count the hearts",
                pdf:"pdf/w1-mon-maths-hearts-count.pdf",
                desc:"–°—á–∏—Ç–∞–µ–º —Å–µ—Ä–¥–µ—á–∫–∏ –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–µ, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º: –±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ.",
                dialog:[
                  "Parent: How many hearts here?",
                  "Parent: Is it more or less than on the other screen?"
                ]},
              { id:"slovene", domain:"Slovene Language", title:"Pri zdravniku",
                pdf:"pdf/w1-mon-slovene-doctor.pdf",
                desc:"–ü—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã: boli me roka, glava, trebuh.",
                dialog:[
                  "Parent: Kako se poƒçuti≈°?",
                  "Child: Boli me roka.",
                  "Parent: Dobro, pogledali bomo roko."
                ]},
              { id:"creative", domain:"Creative Development (Art & Role Play)", title:"Draw a brave helper",
                pdf:"pdf/w1-mon-creative-helper-template.pdf",
                desc:"–®–∞–±–ª–æ–Ω –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞ ¬´–ú–æ–π –≥–µ—Ä–æ–π: –¥–æ–∫—Ç–æ—Ä/–º–µ–¥—Å–µ—Å—Ç—Ä–∞/–ø–æ–∂–∞—Ä–Ω—ã–π¬ª.",
                dialog:[
                  "Parent: Who is your hero today?",
                  "Child: Doctor.",
                  "Parent: What tools does your hero need?"
                ]},
              { id:"world", domain:"Understanding the World", title:"Who works in a hospital?",
                pdf:"pdf/w1-mon-world-hospital-people.pdf",
                desc:"–°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –ª—é–¥–µ–π –∏ –∏—Ö —Ä–æ–ª–∏: doctor, nurse, driver.",
                dialog:[
                  "Parent: Who drives the ambulance?",
                  "Child: The driver.",
                  "Parent: Who helps the patient in the room?"
                ]}
            ]
          },
          tue: {
            title: "Rescue Day ‚Äì Helicopter & Mountain",
            activities: [
              { id:"eng", domain:"English Speaking & Listening", title:"Mountain rescue story",
                pdf:"pdf/w1-tue-english-mountain-story.pdf",
                desc:"–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–æ–∫, —Ä–µ–±—ë–Ω–æ–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—á–∞–ª–æ‚Äì—Å–µ—Ä–µ–¥–∏–Ω—É‚Äì–∫–æ–Ω–µ—Ü.",
                dialog:[
                  "Parent: First, what happens?",
                  "Child: The man is on the mountain.",
                  "Parent: And then? And finally?"
                ]},
              { id:"social", domain:"Social Confidence / Group Interaction", title:"Team talk in the helicopter",
                pdf:"pdf/w1-tue-social-helicopter-team.pdf",
                desc:"–î–∏–∞–ª–æ–≥ –≤ –∫–æ–º–∞–Ω–¥–µ: –ø—Ä–æ—Å–∏–º –æ –ø–æ–º–æ—â–∏, –æ—Ç–≤–µ—á–∞–µ–º ¬´Yes, I can¬ª.",
                dialog:[
                  "Parent: ‚ÄúPetr, can you help with the rope?‚Äù",
                  "Child: ‚ÄúYes, I can help.‚Äù",
                  "Parent: ‚ÄúThank you, team!‚Äù"
                ]},
              { id:"motor", domain:"Fine Motor Skills / Early Writing", title:"Spiral flight path",
                pdf:"pdf/w1-tue-motor-spiral-path.pdf",
                desc:"–°–ø–∏—Ä–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ ‚Äì –≤–µ—Ä—Ç–æ–ª—ë—Ç –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø—É—Å–∫–∞–µ—Ç—Å—è.",
                dialog:[
                  "Parent: Let‚Äôs fly up, up, up along the spiral.",
                  "Parent: Now slowly down."
                ]},
              { id:"maths", domain:"Maths (Numbers & Shapes)", title:"Mountain numbers",
                pdf:"pdf/w1-tue-maths-mountain-steps.pdf",
                desc:"–°—Ç—É–ø–µ–Ω—å–∫–∏ —Å —Ü–∏—Ñ—Ä–∞–º–∏ 1‚Äì10, —Ä–µ–±—ë–Ω–æ–∫ –æ–±–≤–æ–¥–∏—Ç –∏ –ø—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç.",
                dialog:[
                  "Parent: Step 1, step 2‚Ä¶ Can you climb to 10?",
                  "Child: One, two, three‚Ä¶"
                ]},
              { id:"slovene", domain:"Slovene Language", title:"Na gori",
                pdf:"pdf/w1-tue-slovene-mountain.pdf",
                desc:"–°–ª–æ–≤–∞: gora, helikopter, ƒçlovek. –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
                dialog:[
                  "Parent: Kaj je to?",
                  "Child: To je helikopter.",
                  "Parent: Kje je ƒçlovek?",
                  "Child: Na gori."
                ]},
              { id:"creative", domain:"Creative Development (Art & Role Play)", title:"Build a rescue scene",
                pdf:"pdf/w1-tue-creative-rescue-idea.pdf",
                desc:"–ò–¥–µ—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ä—ã –∏ –≤–µ—Ä—Ç–æ–ª—ë—Ç–∞ –∏–∑ LEGO.",
                dialog:[
                  "Parent: Where will the helicopter land?",
                  "Parent: Can you add a safe place for people?"
                ]},
              { id:"world", domain:"Understanding the World", title:"Weather on the mountain",
                pdf:"pdf/w1-tue-world-weather-cards.pdf",
                desc:"–ö–∞—Ä—Ç–∏–Ω–∫–∏ —Ä–∞–∑–Ω–æ–π –ø–æ–≥–æ–¥—ã, –≤—ã–±–∏—Ä–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –¥–ª—è –≥–æ—Ä.",
                dialog:[
                  "Parent: Is it sunny or windy on this picture?",
                  "Parent: Which weather is safe for flying?"
                ]}
            ]
          },
          wed: {
            title: "City Mix Day ‚Äì All Heroes Together",
            activities: [
              { id:"eng", domain:"English Speaking & Listening", title:"My favourite city hero",
                pdf:"pdf/w1-wed-english-favourite-hero.pdf",
                desc:"–†–µ–±—ë–Ω–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç –≥–µ—Ä–æ—è –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
                dialog:[
                  "Parent: Who is your favourite hero?",
                  "Child: My favourite hero is the firefighter.",
                  "Parent: Why do you like him?"
                ]},
              { id:"social", domain:"Social Confidence / Group Interaction", title:"City meeting role play",
                pdf:"pdf/w1-wed-social-heroes-meeting.pdf",
                desc:"–í—Å–µ –≥–µ—Ä–æ–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –æ–±—Å—É–∂–¥–∞—é—Ç, –∫–∞–∫ –ø–æ–º–æ—á—å –≥–æ—Ä–æ–¥—É.",
                dialog:[
                  "Parent (mayor): ‚ÄúThank you for coming!‚Äù",
                  "Parent: ‚ÄúPetr, what can your hero do to help the city?‚Äù"
                ]},
              { id:"motor", domain:"Fine Motor Skills / Early Writing", title:"City map tracing",
                pdf:"pdf/w1-wed-motor-city-map.pdf",
                desc:"–û–±–≤–æ–¥–∏–º –¥–æ—Ä–æ–≥–∏, –º–æ—Å—Ç—ã, —Ä–µ–∫—É, —Å–æ–µ–¥–∏–Ω—è—è –≤–∞–∂–Ω—ã–µ –º–µ—Å—Ç–∞.",
                dialog:[
                  "Parent: Let‚Äôs draw a safe road from home to the station.",
                  "Parent: Try to stay inside the line."
                ]},
              { id:"maths", domain:"Maths (Numbers & Shapes)", title:"City numbers & shapes",
                pdf:"pdf/w1-wed-maths-city-mix.pdf",
                desc:"–°—á–∏—Ç–∞–µ–º –¥–æ–º–∞, –º–∞—à–∏–Ω—ã, –∏—â–µ–º –∏ –Ω–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã.",
                dialog:[
                  "Parent: How many squares can you find?",
                  "Parent: Show me three circles."
                ]},
              { id:"slovene", domain:"Slovene Language", title:"Moje mesto",
                pdf:"pdf/w1-wed-slovene-my-city.pdf",
                desc:"–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ –≥–æ—Ä–æ–¥–µ: To je hi≈°a, To je most.",
                dialog:[
                  "Parent: Kaj je to?",
                  "Child: To je hi≈°a.",
                  "Parent: Super! In to?",
                  "Child: To je most."
                ]},
              { id:"creative", domain:"Creative Development (Art & Role Play)", title:"Draw your LEGO City",
                pdf:"pdf/w1-wed-creative-my-city-template.pdf",
                desc:"–õ–∏—Å—Ç —Å —Ä–∞–º–∫–æ–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏, —Ä–µ–±—ë–Ω–æ–∫ —Ä–∏—Å—É–µ—Ç —Å–≤–æ–π –≥–æ—Ä–æ–¥.",
                dialog:[
                  "Parent: Where is the fire station in your city?",
                  "Parent: Where do you live in this picture?"
                ]},
              { id:"world", domain:"Understanding the World", title:"Who helps in the city?",
                pdf:"pdf/w1-wed-world-city-helpers.pdf",
                desc:"–°–æ–µ–¥–∏–Ω—è–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ –º–µ—Å—Ç–∞: firefighter‚Äìstation, doctor‚Äìhospital.",
                dialog:[
                  "Parent: Who works in the hospital?",
                  "Child: Doctor.",
                  "Parent: And who works at the fire station?"
                ]}
            ]
          }
        }
      },

      // –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ–¥–µ–ª–∏ ‚Äì –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, –Ω–æ –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤, —á—Ç–æ–±—ã –∫–æ–¥ –Ω–µ —Ä–∞–∑—Ä–∞—Å—Ç–∞–ª—Å—è –¥–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏.
      week2: { label: "Week 2 ‚Äì City Vehicles", englishPhrases: [], slovenePhrases: [], days: {} },
      week3: { label: "Week 3 ‚Äì City Jobs", englishPhrases: [], slovenePhrases: [], days: {} },
      week4: { label: "Week 4 ‚Äì City Adventures", englishPhrases: [], slovenePhrases: [], days: {} }
    };

    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∑–∞–ø–æ–ª–Ω–∏–º –Ω–µ–¥–µ–ª–∏ 2‚Äì4 —Ç–µ–º–∏ –∂–µ –º–∏—Å—Å–∏—è–º–∏, —á—Ç–æ –∏ Week1, –Ω–æ —Å –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é –Ω–µ–¥–µ–ª–∏:
    ["week2", "week3", "week4"].forEach((wkKey) => {
      PROGRAM[wkKey].days = PROGRAM.week1.days;
      PROGRAM[wkKey].englishPhrases = PROGRAM.week1.englishPhrases;
      PROGRAM[wkKey].slovenePhrases = PROGRAM.week1.slovenePhrases;
    });

    // === State ===
    let state = loadState();

    childNameInput.value = state.childName || "Petr";
    childLabel.textContent = state.childName || "Petr";
    weekSelect.value = state.week || "week1";
    daySelect.value = state.day || "sat";

    renderPhrases();
    renderDay();
    notesArea.value = (state.notes[state.week] || {})[state.day] || "";

    // Shared audio element for phrases
    const audioEl = new Audio();

    // Events
    childNameInput.addEventListener("input", () => {
      state.childName = childNameInput.value.trim();
      childLabel.textContent = state.childName || "Petr";
      saveState();
    });

    weekSelect.addEventListener("change", () => {
      state.week = weekSelect.value;
      saveState();
      renderPhrases();
      renderDay();
      notesArea.value = (state.notes[state.week] || {})[state.day] || "";
    });

    daySelect.addEventListener("change", () => {
      state.day = daySelect.value;
      saveState();
      renderDay();
      notesArea.value = (state.notes[state.week] || {})[state.day] || "";
    });

    notesArea.addEventListener("input", () => {
      if (!state.notes[state.week]) state.notes[state.week] = {};
      state.notes[state.week][state.day] = notesArea.value;
      saveState();
    });

    function renderPhrases() {
      const weekData = PROGRAM[weekSelect.value];
      phrasesWeekLabel.textContent = weekData.label;

      englishPhrasesEl.innerHTML = "";
      slovenePhrasesEl.innerHTML = "";

      weekData.englishPhrases.forEach((p) => {
        englishPhrasesEl.appendChild(createPhraseCard(p, "EN"));
      });
      weekData.slovenePhrases.forEach((p) => {
        slovenePhrasesEl.appendChild(createPhraseCard(p, "SL"));
      });
    }

    function createPhraseCard(phrase, lang) {
      const card = document.createElement("div");
      card.className = "phrase-card";

      const header = document.createElement("div");
      header.className = "phrase-header";

      const text = document.createElement("div");
      text.className = "phrase-text-main";
      text.textContent = phrase.text;

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn btn-primary";
      btn.textContent = "‚ñ∂ Play";
      btn.addEventListener("click", () => {
        const src = `audio/${phrase.id}.mp3`;
        audioEl.src = src;
        audioEl.play().catch(() => {
          alert("Audio file not found yet. Please upload " + src + " to the repository.");
        });
      });

      header.appendChild(text);
      header.appendChild(btn);

      const tr = document.createElement("div");
      tr.className = "phrase-translation";
      tr.textContent = phrase.translation;

      const tip = document.createElement("div");
      tip.className = "small-text";
      tip.textContent = phrase.tip || "";

      card.appendChild(header);
      card.appendChild(tr);
      card.appendChild(tip);

      return card;
    }

    function renderDay() {
      const weekKey = weekSelect.value;
      const dayKey = daySelect.value;
      const weekData = PROGRAM[weekKey];
      const dayData = weekData.days[dayKey];

      dayLabel.textContent = `${DAYS_LABEL[dayKey]} ¬∑ ${dayData.title}`;
      missionsGrid.innerHTML = "";

      dayData.activities.forEach((act) => {
        const card = document.createElement("div");
        card.className = "mission-card";

        const domainEl = document.createElement("div");
        domainEl.className = "mission-domain";
        domainEl.textContent = act.domain;

        const titleEl = document.createElement("div");
        titleEl.className = "mission-title";
        titleEl.textContent = act.title;

        const descEl = document.createElement("div");
        descEl.className = "mission-desc";
        descEl.textContent = act.desc;

        const actions = document.createElement("div");
        actions.className = "mission-actions";

        const link = document.createElement("a");
        link.className = "btn btn-primary";
        link.href = act.pdf;
        link.target = "_blank";
        link.rel = "noopener";
        link.textContent = "Download PDF";

        const hintBtn = document.createElement("button");
        hintBtn.type = "button";
        hintBtn.className = "btn btn-ghost";
        hintBtn.textContent = "PDF path";
        hintBtn.addEventListener("click", () => {
          alert("Upload the PDF for this task to:\n" + act.pdf);
        });

        actions.appendChild(link);
        actions.appendChild(hintBtn);

        const status = document.createElement("div");
        status.className = "mission-status";

        const actState = getActivityState(weekKey, dayKey, act.id);

        const doneLabel = document.createElement("label");
        const doneCheckbox = document.createElement("input");
        doneCheckbox.type = "checkbox";
        doneCheckbox.checked = !!actState.done;
        doneLabel.appendChild(doneCheckbox);
        doneLabel.append(" Done by child");

        const checkedLabel = document.createElement("label");
        const checkedCheckbox = document.createElement("input");
        checkedCheckbox.type = "checkbox";
        checkedCheckbox.checked = !!actState.checked;
        checkedLabel.appendChild(checkedCheckbox);
        checkedLabel.append(" Checked by parent");

        doneCheckbox.addEventListener("change", () => {
          actState.done = doneCheckbox.checked;
          if (!actState.done && actState.checked) {
            actState.checked = false;
            checkedCheckbox.checked = false;
          }
          saveState();
          updateSummary(weekKey, dayKey);
        });

        checkedCheckbox.addEventListener("change", () => {
          actState.checked = checkedCheckbox.checked;
          if (actState.checked && !actState.done) {
            actState.done = true;
            doneCheckbox.checked = true;
          }
          saveState();
          updateSummary(weekKey, dayKey);
        });

        status.appendChild(doneLabel);
        status.appendChild(checkedLabel);

        const details = document.createElement("details");
        const summary = document.createElement("summary");
        summary.textContent = "Parent dialogue idea";
        details.appendChild(summary);

        const dialogText = document.createElement("div");
        dialogText.className = "small-text";
        dialogText.innerHTML = (act.dialog || [])
          .map((line) => line.replace(/Parent/g, "<strong>Parent</strong>").replace(/Child/g, "<strong>Child</strong>"))
          .join("<br>");
        details.appendChild(dialogText);

        card.appendChild(domainEl);
        card.appendChild(titleEl);
        card.appendChild(descEl);
        card.appendChild(actions);
        card.appendChild(status);
        card.appendChild(details);

        missionsGrid.appendChild(card);
      });

      updateSummary(weekKey, dayKey);
    }

    function updateSummary(weekKey, dayKey) {
      const acts = PROGRAM[weekKey].days[dayKey].activities;
      const total = acts.length;
      let done = 0;
      let checked = 0;
      acts.forEach((act) => {
        const st = getActivityState(weekKey, dayKey, act.id);
        if (st.done) done++;
        if (st.checked) checked++;
      });

      totalMissionsEl.textContent = total;
      doneCountEl.textContent = done;
      checkedCountEl.textContent = checked;

      const percent = total ? Math.round((checked / total) * 100) : 0;
      progressBarEl.style.width = percent + "%";
    }

    function getActivityState(weekKey, dayKey, actId) {
      if (!state.activities[weekKey]) state.activities[weekKey] = {};
      if (!state.activities[weekKey][dayKey]) state.activities[weekKey][dayKey] = {};
      if (!state.activities[weekKey][dayKey][actId]) {
        state.activities[weekKey][dayKey][actId] = { done: false, checked: false };
      }
      return state.activities[weekKey][dayKey][actId];
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          return {
            childName: "Petr",
            week: "week1",
            day: "sat",
            activities: {},
            notes: {}
          };
        }
        const parsed = JSON.parse(raw);
        if (!parsed.activities) parsed.activities = {};
        if (!parsed.notes) parsed.notes = {};
        if (!parsed.week) parsed.week = "week1";
        if (!parsed.day) parsed.day = "sat";
        return parsed;
      } catch (e) {
        console.error("Failed to load state", e);
        return {
          childName: "Petr",
          week: "week1",
          day: "sat",
          activities: {},
          notes: {}
        };
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
  })();
</script>
</body>
</html>
